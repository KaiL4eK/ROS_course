# Hello, TurtleBot!

В этой теме мы улучшим запуск черепашки до трехмерной модели! Представьте себе, робот с кучей крутых датчиков в симуляторе на нашем компьютере! Вау!

Так давайте начнем, первым делом установим все необходимые пакеты:

```bash
sudo apt install \
    ros-noetic-gmapping \
    ros-noetic-turtlebot3-gazebo \
    ros-noetic-turtlebot3-teleop \
    ros-noetic-turtlebot3-slam
```

## Робот, покажись!

Теперь начнем знакомиться, давайте запустим нашего робота в симуляторе и увидим, что запустилось все правильно!

```bash
# TURTLEBOT3_MODEL=waffle - означает установку переменной окружения для запуска данной команды (мы указываем желаемую модель)
TURTLEBOT3_MODEL=waffle roslaunch turtlebot3_gazebo turtlebot3_world.launch
```

После выполнения команды у вас должен запуститься симулятор **Gazebo**, в котором будет наш робот:

<p align="center">
<img src=../assets/01_waffle_start.png />
</p>

Вон там снизу справа видите робота? Это наша вафелька! Если быть точнее, то Turtlebot модели Waffle =)

Попробуйте приблизиться с помощью левой, плавой клавиш мыши и колесика (на колесико еще можно нажимать) и разглядень поближе:

<p align="center">
<img src=../assets/01_waffle_close_view.png />
</p>

Какая хорошая детализация, не так ли? Красивый робот =)

Полюбуйтесь еще минутку на робота, осмотрите карту и двигаем дальше!

## Пора двигаться!

Робот в симуляторе - это безопасная зверюшка, с которой можно делать что угодно, даже если и сломается, то перезапуск все починет!

Чтобы заставить робота двигаться надо передать роботу команды управления. Сейчас мы его просто запустили, даже немного осмотрели, но ничего не передаем.

Давайте запустим команду, которая включит возможность управления роботом с клавиатуры, как мы делали с 2D черепашкой:

> **Симулятор не выключайте!** Делаем это в отдельном окне!

```bash
# Обратите внимание, тут тоже просят модельку задать
TURTLEBOT3_MODEL=waffle roslaunch turtlebot3_teleop turtlebot3_teleop_key.launch
```

:muscle: Таакс, настроили окна, положили пальцы на WASD (еще X для хода назад) и погнали!

<p align="center">
<img src=../assets/01_waffle_keyboard_control.png />
</p>

Отлично! Но подумайте, чтобы управлять роботом, вам нужно смотреть сверху, где он находится. Вы в симуляторе смотрите с птичьего вида, а что если нам нужно работать с роботом, которому надо залазить в очень тесные и непролазные места? Нужно научить робота видеть!

## Научим робота видеть!

Чтобы дать роботу глаза потребуется две составляющие:
- Датчик, который передает информацию об окружающем мире;
- Программа, которая обрабатывает данные с датчика и позволяет воспринимать информацию о дистанции до объектов.

В качестве датчика у нас будет выступать **лидар**! Смотрите, где он установлен:

<p align="center">
<img src=../assets/01_waffle_lidar.png />
</p>

Подробности о лидаре вы узнаете на лекциях, а пока считаем, что это датчик, который сканирует плоскость и получает информацию о расстояниях до препятствий вокруг.

Отлично! Датчик у нас есть, а теперь давайте в третьем терминале запустим программу, которая позволит роботу получать информацию с датчиков и обрабатывать ее:

```bash
TURTLEBOT3_MODEL=waffle roslaunch turtlebot3_slam turtlebot3_slam.launch
```

<p align="center">
<img src=../assets/01_waffle_mapping.png />
</p>

Если все запустилось правильно, то запустились программы для получения и обработки данных с лидара. Вы можете их видеть в интерфейсе программы **rviz**. Rviz - это интерфейс отображения информации в системе робота.

Тут немного разберемся, в Gazebo Вы видите виртуальный мир симулятора, будто вы смотрите своими глазами, а Rviz - это интерфейс для отображения разной информации, которая есть в роботе! По сути, это взгляд глазами робота. Сами посудите, своими глазами сверху вы видите всю карту, а робот видит только часть, пока никуда не двигался.

Давайте посмотрим на информацию пока только с лидара? Отключите отображение карты, чтобы были видны только робот и данные с лидара:

<p align="center">
<img src=../assets/01_waffle_map_disabled.png />
</p>

Отлично, теперь вы видите только то, что приходит с лидара без обработки!

Давайте попробуем немного поменять наш виртуальный мир и убедиться, что информация с лидара меняется! 

Поставьте цилиндр на свою карту с помощью кнопки цилиндра и проверьте, как поменялись ваши данные с лидара:

<p align="center">
<img src=../assets/01_waffle_new_object.png />
</p>

Поменялись? Понимаете, как они меняются, если ставите цилиндр в разных местах?

Попробуйте попередвигать/поразворачивать/изменять размер цилиндра с помощью этого меню:

<p align="center">
<img src=../assets/01_gazebo_object_control.png />
</p>

Убедитесь, что вы понимаете, как меняются данные с лидара.

:muscle: Небольшое задание, попробуйте поменять размер (диаметр) цилиндра так, чтобы он пропал с лидара. Зависит ли диаметр пропадания от расстояния?

Отлично, после небольшого исследования возвращаем карту на место (включаем в rviz). Если вы активно двигали цилиндр, то вы можете увидеть накарте такие участки:

<p align="center">
<img src=../assets/01_rviz_map_dirty.png />
</p>

Это остатки рабочей системы построения карты в нашей среде. Ведь в Rviz мы только отключили отображение карты, но построение карты работало в фоне все это время! 

Но не беда, сейчас мы будем катать по карте и в ходе покатушек карта обновится и ложные препятствия пропадут.

:muscle: Упс, я уже немного раскрыл ваше следующее задание.. Поехали, переключаем фокус на терминал с управлением с клавиатуры (если закрыли, не беда, просто включите управление teleop) и твоя задача - построить карту нашей небольшой местности. А если чувствуешь в себе дух гонщика, то попробуй сделать это на скорость!

Представляешь, ты всего лишь с помощью пары команд смог запустить робота в симуляторе и уже катаешь его с помощью своей собственной клавиатуры и строишь карту! Круто, правда?

Но согласись, сегодня дистанционным управлением по кнопкам никого не удивить, давай заставим робота двигаться к цели, учитывая информацию с карты?

## Робот, который смог (двигаться к цели)!

Давайте выключим все кроме самого симулятора (world). 


## Задачки!

Настала время первых эксперименов! Они очень полезны, так как пытаясь поменять что-то в системе и понять, почему так происходит, Вы приобретаете кучу опыта!

- В данных Image поменяйте ImageTopic на `/camera/rgb/image_raw` и покатайтесь. Как думаете, что это за информация?
- Попробуйте отключить RobotModel, включить TF и покататься по карте. Подсказка, TF - это разные системы координат. Как Вы думаете, почему часть TF стоит на месте, а часть двигается? Какие TF стоят на месте? Отключить часть TF можно в меню TF->Frames.

## Вопросики =)

- Что нужно, чтобы обеспечить роботу возможность видеть? А если слышать или чувствовать запахи?
- Какие проблемы имеет лидар?
